version: 2
jobs:
  build:
    docker:
      - image: buildpack-deps:jessie-scm
    steps:
      - run:
          - type: shell
              name: Initialize Working Directory
              pwd: /
              command: |
                mkdir /tests

      - run: git clone https://github.com/labsai/EDDI-integration-tests.git /tests

      - run: docker login -e $DOCKER_EMAIL -u $DOCKER_USER -p $DOCKER_PASS

      - run: docker build -t labsai/eddi-integration-tests:b$CIRCLE_BUILD_NUM .
      - run: docker push -t labsai/eddi-integration-tests:b$CIRCLE_BUILD_NUM

      - run: docker build -t labsai/eddi-integration-tests:latest .
      - run: docker push -t labsai/eddi-integration-tests:latest
