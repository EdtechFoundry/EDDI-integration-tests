version: 2
jobs:
  build:
    working_directory: ~/circulate
    docker:
      - image: buildpack-deps:jessie-scm
    steps:
      - run: mkdir /tests

      - run: chmod -R 777 /tests/

      - run: git clone https://github.com/labsai/EDDI-integration-tests.git /tests

      - run: docker login -e $DOCKER_EMAIL -u $DOCKER_USER -p $DOCKER_PASS

      - run: docker build -t labsai/eddi-integration-tests:b$CIRCLE_BUILD_NUM .
      - run: docker push -t labsai/eddi-integration-tests:b$CIRCLE_BUILD_NUM

      - run: docker build -t labsai/eddi-integration-tests:latest .
      - run: docker push -t labsai/eddi-integration-tests:latest
